{{ $name := "hugo-mod-img – img/func/class/embed" }}
{{ $configName := "data/hugoModImage" }}
{{ $errorLevel := site.Data.hugoModImage.errorLevel | default "warning" | lower }}
{{ $configErrorEnd := printf "See configuration in %s" $configName }}

{{ $params := . }}
{{ $baseClass := "embed" }}
{{ $classes := (slice $baseClass) }}
{{ with site.Data.hugoModImage.embed.class }} 
    {{ $classMap := . }}
    {{ range $k, $v := $params.class }}
        {{ with (index $classMap $k)  }}
            {{ if in .options $v }}
                {{ $classes = $classes | append (printf "%s--%s%s" $baseClass .prefix $v ) }}
            {{ else }}
                {{ $msg := printf "%s %q is not in %s. %s" .name $v .options $configErrorEnd }}
                {{ partial "error-msg" (dict "caller" $name "errorMsg" $msg "errorLevel" $errorLevel ) }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ else }}
    {{ $msg := print "Can’t find embedded image classes. " $configErrorEnd }}
    {{ partial "error-msg" (dict "caller" $name "errorMsg" $msg "errorLevel" $errorLevel )}}
{{ end }}

{{ with $params.class.plain }}
    {{ $classes = $classes | append (print .) }}
{{ end }}

{{ with $params.attrs.class }}
    {{ $classes = $classes | append (print .) }}
{{ end }}

{{ $params = merge $params (dict (slice "attrs" "class") (delimit $classes " ")) }}

{{ return $params }}