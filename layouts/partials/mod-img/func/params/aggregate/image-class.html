{{ $params := . }}

{{ $name := "mod-img/func/params/aggregate/image-class" }}
{{ $errorLevel := site.Data.modImg.errorLevel | default "warning" }}
{{ $configErrorEnd := "See configuration in data/mod-img" }}

{{ $classes := slice }}
{{ with index site.Data.modImg.image.class }}
    {{ $classMap := . }}
    {{ $baseClass := .base }}
    {{ $classes = $classes | append (print $baseClass) }}        
    {{ range $k, $v := $params.imgClass }}
        {{ with (index $classMap $k)  }}
            {{ if in .options $v }}
                {{ $classes = $classes | append (printf "%s--%s%s" $baseClass .prefix $v ) }}
            {{ else }}
                {{ $msg := printf "%s %q is not in %s. %s" .name $v .options $configErrorEnd }}
                {{ partial "error-msg" (dict "caller" $name "errorMsg" $msg "errorLevel" $errorLevel ) }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ else }}
    {{ $msg := printf "Canâ€™t find image class configuration. %s" $configErrorEnd }}
    {{ partial "error-msg" (dict "caller" $name "errorMsg" $msg "errorLevel" $errorLevel ) }}
{{ end }}

{{ $params = merge $params (dict (slice "imgAttrs" "class") (delimit $classes " ")) }}
{{ return $params }}