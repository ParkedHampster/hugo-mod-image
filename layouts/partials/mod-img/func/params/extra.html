{{/* Context: parameter map */}}

{{- $params := dict }}

{{ with .id }}{{ $params = merge $params (dict (slice "attrs" "id") ( . | lower )) }}{{ end }}
{{ with or .width .w }}{{ $params = merge $params (dict (slice "class" "width") ( (string .) | lower )) }}{{ end }}
{{ with or .posh .ph }}{{ $params = merge $params (dict (slice "class" "posh") ( . | lower )) }}{{ end }}
{{ with or .posv .pv }}{{ $params = merge $params (dict (slice "class" "posv") ( . | lower )) }}{{ end }}
{{ with .class }}{{ $params = merge $params (dict (slice "class" "plain") ( . | lower )) }}{{ end }}

{{ with .link }}{{ $params = merge $params (dict (slice "linkAttrs" "href") . ) }}{{ end }}
{{ with .rel }}{{ $params = merge $params (dict (slice "linkAttrs" "rel") ( . | lower )) }}{{ end }}
{{ with .target }}{{ $params = merge $params (dict (slice "linkAttrs" "target") ( . | lower )) }}{{ end }}
{{ with .background }}{{ $params = merge $params (dict (slice "frameClass" "background") ( . | lower )) }}{{ end }}
{{ with .box }}{{ $params = merge $params (dict (slice "frameClass" "box") ( . | lower )) }}{{ end }}
{{ with .padding }}{{ $params = merge $params (dict (slice "frameClass" "padding") ( . | lower )) }}{{ end }}
{{ with .type }}{{ $params = merge $params (dict (slice "contClass" "type") ( . | lower )) }}{{ end }}

{{ with or .alt .caption }}
    {{ $params = merge $params (dict (slice "imgAttrs" "alt") . ) }}    
{{ end }}

{{ $params := partial "mod-img/func/params/theme" $params }}

{{ with .ratio }}{{ $params = merge $params (dict (slice "preprocess" "ratio") . ) }}{{ end }}
{{ with .zoom }}{{ $params = merge $params (dict (slice "preprocess" "zoom") . ) }}{{ end }}
{{ with .rotate }}{{ $params = merge $params (dict (slice "preprocess" "rotate") (. | lower) ) }}{{ end }}
{{ with .hint }}{{ $params = merge $params (dict (slice "preprocess" "hint") . ) }}{{ end }}
{{ with .anchor }}{{ $params = merge $params (dict (slice "preprocess" "anchor")  . ) }}{{ end }}
{{ with or .svg site.Data.modImg.svg }}
    {{ $params = merge $params (dict (slice "process" "svg") ( . | lower )) }}
{{ end }}
{{ with .lqip }}{{ $run := false }}{{ if (eq . "yes") }}{{ $run = true }}{{ end }}
    {{ $params = merge $params (dict (slice "lqip" "run") $run) }}
{{ end }}

{{ return $params }}

{{ define "partials/mod-img/func/params/theme.html" }}{{ return . }}{{ end }}