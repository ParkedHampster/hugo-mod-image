{{/* 
    Context:
        - img
        - params
*/}}

{{ $params := .params }}
{{- if (eq $params.process.svg "inline") }}
    {{ with $params.imgAttrs.alt }}
        {{ $params = merge $params (dict (slice "imgAttrs" "aria-label") . )}}
    {{ end }}        
    <span 
        {{- range $k, $v := $params.imgAttrs }}
            {{ if not (in (slice "src" "alt" ) $k) }}
                {{- printf " %s=%q" $k $v | safeHTMLAttr }}
            {{- end }}
        {{- end }}>
    {{- .img.Content | safeHTML }}
    </span>
    {{- if .params.index -}} {{- /* Hidden img with pagefind attributes */}}
        <img class="hide"
            data-pagefind-meta="image[data-src], image_alt[alt]" 
            data-src="{{ $.params.imgAttrs.src | safeHTMLAttr }}" 
            {{- with .params.imgAttrs.alt }}alt="{{ . | safeHTMLAttr }}"{{ end }}>
    {{- end }}
{{- else }}
    {{- $params := merge .params (dict (slice "imgAttrs" "loading") "lazy" ) }}
    {{- if .params.index }}
        {{- $params = merge $params (dict (slice "imgAttrs" "data-pagefind-meta") "image[data-src], image_alt[alt]" ) }}
    {{- end }}
    <img {{- range $k, $v := $params.imgAttrs }}
            {{- printf " %s=%q" $k $v | safeHTMLAttr }}
        {{- end }}>
{{- end }}